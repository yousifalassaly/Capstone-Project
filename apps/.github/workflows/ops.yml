name: ops

on:
  workflow_dispatch:
    inputs:
      action:
        description: "Operational action to perform"
        required: true
        type: string

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ansible

      - name: Run requested playbook
        env:
          ACTION: ${{ github.event.inputs.action }}
        run: |
          case "$ACTION" in
            run)
              ansible-playbook apps/ansible/playbooks/batch_run.yml -i apps/ansible/inventory.ini
              ;;
            rerun)
              ansible-playbook apps/ansible/playbooks/batch_rerun.yml -i apps/ansible/inventory.ini
              ;;
            fix)
              ansible-playbook apps/ansible/playbooks/fix_issue.yml -i apps/ansible/inventory.ini
              ;;
            *)
              echo "Unknown action: $ACTION"
              exit 1
              ;;
          esac

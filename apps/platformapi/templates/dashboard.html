{% extends "layout.html" %}

{% block content %}
<style>
body, html { margin:0; padding:0; font-family:system-ui, -apple-system, BlinkMacSystemFont, sans-serif; background:#0b1020; color:#e6eef8 }
.container { max-width:900px; margin:40px auto; padding:24px; background:rgba(255,255,255,0.03); border-radius:10px }
h1 { margin-top:0 }
.card { padding:12px; background:rgba(255,255,255,0.02); border-radius:8px; margin-bottom:12px }
.code { background:#071027; padding:10px; border-radius:6px; font-family:monospace }
</style>

<div class="container">
  <h1>{{ title or 'Platform API' }}</h1>
  <div class="card">
    <h3>Health</h3>
    <p>Check service health: <a href="{{ health_url }}">{{ health_url }}</a></p>
  </div>

  <div class="card">
    <h3>Available endpoints</h3>
    <ul>
      {% for ep in endpoints %}
        <li><span class="code">{{ ep }}</span></li>
      {% endfor %}
    </ul>
  </div>

  <div class="card">
   <h3>Ansible â€” Ping Targets</h3>
   <p>Targets: <span id="targets">{{ targets | join(', ') }}</span></p>
   <button id="run-ansible">Run Ansible Ping</button>
   <pre id="ansible-output"
    style="white-space:pre-wrap; margin-top:12px; background:#071027; padding:12px; border-radius:6px; color:#cfe7ff"></pre>
  </div>
  
  <script>
   const runBtn = document.getElementById('run-ansible');
   const out = document.getElementById('ansible-output');
   const targetsText = document.getElementById('targets').innerText || '';
   const defaultHosts = targetsText.split(',').map(s => s.trim()).filter(Boolean);

   runBtn.addEventListener('click', async () => {
    out.textContent = 'Running ansible ping...';
    try {
     const resp = await fetch('/ansible/ping', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ hosts: defaultHosts })
     });
     const data = await resp.json();
     if (data.success) {
      out.textContent = data.stdout || '(no stdout)';
     } else {
      out.textContent = data.error || data.stderr || JSON.stringify(data, null, 2);
     }
    } catch (err) {
     out.textContent = 'Request failed: ' + err.message;
    }
   });
  </script>

{% endblock %}
